---
/**
 * Left Sidebar Component
 *
 * @description Navigation dashboard for the left sidebar.
 * Contains hierarchical categories and series navigation.
 *
 * Features:
 * - Hierarchical category tree
 * - Series list with progress
 * - Active state highlighting
 * - Collapsible sections
 *
 * @example
 * ```astro
 * <LeftSidebar activeCategory="Web Development" />
 * ```
 */

import { Icon } from 'astro-icon/components';
import { getCategoryList, getSeriesWithCounts } from '@utils/content-utils';
import { seriesData } from '@data/series';
import { getUrl } from '@utils/url-utils';
import { i18n, I18nKey } from '@i18n/index';

interface Props {
  /** Currently active category slug */
  activeCategory?: string;
  /** Currently active series ID */
  activeSeries?: string;
}

const { activeCategory, activeSeries } = Astro.props;

// Fetch data
const categories = await getCategoryList();
const seriesWithCounts = await getSeriesWithCounts();

// Only show series that have posts
const activeSeries_ = seriesWithCounts.filter((s) => s.postCount > 0);
---

<nav class="left-sidebar-nav" aria-label="Blog navigation">
  {/* Categories Section */}
  <section class="nav-section">
    <header class="section-header">
      <Icon name="material-symbols:folder-open" class="section-icon" />
      <h2 class="section-title">{i18n(I18nKey.categories)}</h2>
      <span class="section-count">{categories.length}</span>
    </header>

    <ul class="nav-list" role="list">
      {/* All Posts Link */}
      <li>
        <a
          href={getUrl('/posts/')}
          class:list={[
            'nav-item',
            { active: !activeCategory },
          ]}
          aria-current={!activeCategory ? 'page' : undefined}
        >
          <Icon name="material-symbols:article" class="item-icon" />
          <span class="item-text">{i18n(I18nKey.allPosts)}</span>
        </a>
      </li>

      {/* Category List */}
      {categories.map((category) => (
        <li>
          <a
            href={getUrl(`/posts/category/${encodeURIComponent(category.name.toLowerCase())}/`)}
            class:list={[
              'nav-item',
              { active: activeCategory?.toLowerCase() === category.name.toLowerCase() },
            ]}
            aria-current={activeCategory?.toLowerCase() === category.name.toLowerCase() ? 'page' : undefined}
          >
            <Icon name="material-symbols:label" class="item-icon" />
            <span class="item-text">{category.name}</span>
            <span class="item-count">{category.count}</span>
          </a>
        </li>
      ))}
    </ul>
  </section>

  {/* Series Section */}
  {activeSeries_.length > 0 && (
    <section class="nav-section">
      <header class="section-header">
        <Icon name="material-symbols:library-books" class="section-icon" />
        <h2 class="section-title">{i18n(I18nKey.series)}</h2>
        <span class="section-count">{activeSeries_.length}</span>
      </header>

      <ul class="nav-list" role="list">
        {activeSeries_.map((series) => (
          <li>
            <a
              href={getUrl(`/series/${series.id}/`)}
              class:list={[
                'nav-item series-item',
                { active: activeSeries === series.id },
              ]}
              aria-current={activeSeries === series.id ? 'page' : undefined}
            >
              <div class="series-info">
                <Icon name="material-symbols:book-2" class="item-icon" />
                <span class="item-text">{series.title}</span>
              </div>
              <div class="series-meta">
                <span class:list={['series-status', series.status]}>
                  {series.status === 'completed' ? '✓' : series.status === 'ongoing' ? '◦' : '⏸'}
                </span>
                <span class="item-count">{series.postCount}</span>
              </div>
            </a>
          </li>
        ))}

        {/* View All Series Link */}
        <li>
          <a href={getUrl('/series/')} class="nav-item view-all">
            <Icon name="material-symbols:arrow-forward" class="item-icon" />
            <span class="item-text">{i18n(I18nKey.viewAll)}</span>
          </a>
        </li>
      </ul>
    </section>
  )}
</nav>

<style>
  .left-sidebar-nav {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  /* Section Styles */
  .nav-section {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    overflow: hidden;
  }

  .section-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem 1rem 0.75rem;
    border-bottom: 1px solid var(--border-color);
    background: oklch(var(--primary) / 0.03);
  }

  .section-icon {
    width: 1.125rem;
    height: 1.125rem;
    color: oklch(var(--primary));
    flex-shrink: 0;
  }

  .section-title {
    font-size: 0.8125rem;
    font-weight: 600;
    color: var(--text-primary);
    text-transform: uppercase;
    letter-spacing: 0.025em;
    flex: 1;
  }

  .section-count {
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--text-tertiary);
    background: var(--border-color);
    padding: 0.125rem 0.5rem;
    border-radius: 9999px;
  }

  /* Navigation List */
  .nav-list {
    list-style: none;
    padding: 0.5rem;
    margin: 0;
  }

  /* Navigation Item */
  .nav-item {
    display: flex;
    align-items: center;
    gap: 0.625rem;
    padding: 0.625rem 0.75rem;
    border-radius: 8px;
    text-decoration: none;
    color: var(--text-secondary);
    font-size: 0.875rem;
    transition: all 0.15s ease;
  }

  .nav-item:hover {
    background: var(--btn-hover-bg);
    color: var(--text-primary);
  }

  .nav-item.active {
    background: oklch(var(--primary) / 0.1);
    color: oklch(var(--primary));
    font-weight: 500;
  }

  .nav-item.active .item-icon {
    color: oklch(var(--primary));
  }

  .item-icon {
    width: 1rem;
    height: 1rem;
    flex-shrink: 0;
    color: var(--text-tertiary);
    transition: color 0.15s ease;
  }

  .nav-item:hover .item-icon {
    color: oklch(var(--primary));
  }

  .item-text {
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .item-count {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    background: var(--btn-regular-bg);
    padding: 0.125rem 0.5rem;
    border-radius: 9999px;
    transition: all 0.15s ease;
  }

  .nav-item:hover .item-count,
  .nav-item.active .item-count {
    background: oklch(var(--primary) / 0.15);
    color: oklch(var(--primary));
  }

  /* Series Item */
  .series-item {
    flex-direction: column;
    align-items: stretch;
    gap: 0.375rem;
  }

  .series-info {
    display: flex;
    align-items: center;
    gap: 0.625rem;
  }

  .series-meta {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 0.5rem;
    padding-left: 1.625rem;
  }

  .series-status {
    font-size: 0.75rem;
    color: var(--text-tertiary);
  }

  .series-status.completed {
    color: #22c55e;
  }

  .series-status.ongoing {
    color: oklch(var(--primary));
  }

  /* View All Link */
  .view-all {
    margin-top: 0.25rem;
    border-top: 1px solid var(--border-color);
    padding-top: 0.75rem;
    font-size: 0.8125rem;
  }

  .view-all .item-icon {
    width: 0.875rem;
    height: 0.875rem;
  }
</style>
