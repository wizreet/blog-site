---
/**
 * Tags Widget Component
 *
 * @description Displays a cloud of post tags in the sidebar.
 * Tags are shown as clickable badges.
 */

import { Icon } from 'astro-icon/components';
import { getTags } from '@utils/content-utils';
import { getTagUrl } from '@utils/url-utils';
import { i18n, I18nKey } from '@i18n/index';

// Get tags with counts
const tags = await getTags();

// Sort by count (descending)
const sortedTags = tags.sort((a, b) => b.count - a.count);

// Limit to top tags for sidebar
const displayTags = sortedTags.slice(0, 15);
const hasMore = sortedTags.length > 15;
---

<div class="card-base p-4">
  <!-- Header -->
  <h3 class="mb-3 flex items-center gap-2 text-sm font-semibold uppercase tracking-wider text-[var(--text-secondary)]">
    <Icon name="material-symbols:tag" class="h-4 w-4" />
    {i18n(I18nKey.tags)}
  </h3>

  <!-- Tags Cloud -->
  {
    displayTags.length > 0 ? (
      <div class="flex flex-wrap gap-2">
        {displayTags.map((tag) => (
          <a
            href={getTagUrl(tag.name)}
            class="inline-flex items-center gap-1 rounded-md bg-[var(--btn-regular-bg)] px-2.5 py-1 text-xs transition-colors hover:bg-[var(--btn-hover-bg)] hover:text-[oklch(var(--primary))]"
          >
            <span class="text-[var(--text-tertiary)]">#</span>
            <span class="text-[var(--text-secondary)]">{tag.name}</span>
          </a>
        ))}
      </div>
    ) : (
      <p class="text-sm text-[var(--text-tertiary)]">No tags yet</p>
    )
  }

  <!-- View All Link -->
  {
    hasMore && (
      <a
        href={getTagUrl('')}
        class="mt-3 flex items-center justify-center gap-1 rounded-md py-2 text-sm text-[var(--text-secondary)] transition-colors hover:bg-[var(--btn-hover-bg)] hover:text-[oklch(var(--primary))]"
      >
        <span>{i18n(I18nKey.viewAll)}</span>
        <Icon name="material-symbols:arrow-forward" class="h-4 w-4" />
      </a>
    )
  }
</div>
