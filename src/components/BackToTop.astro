---
/**
 * Back to Top Component
 *
 * @description A floating button that appears when the user scrolls down.
 * Clicking it smoothly scrolls back to the top of the page.
 *
 * Features:
 * - Only visible when scrolled past threshold
 * - Smooth scroll animation
 * - Keyboard accessible
 */

import { Icon } from 'astro-icon/components';
import { i18n, I18nKey } from '@i18n/index';
---

<button
  id="back-to-top"
  class="fixed bottom-20 right-6 z-30 flex h-10 w-10 translate-y-20 items-center justify-center rounded-full bg-[var(--btn-regular-bg)] opacity-0 shadow-lg transition-all duration-300 hover:bg-[var(--btn-hover-bg)] focus:outline-none focus:ring-2 focus:ring-[oklch(var(--primary))] focus:ring-offset-2 lg:bottom-6"
  aria-label={i18n(I18nKey.backToTop)}
  title={i18n(I18nKey.backToTop)}
>
  <Icon name="material-symbols:arrow-upward" class="h-5 w-5" />
</button>

<script>
  function initBackToTop() {
    const button = document.getElementById('back-to-top');
    if (!button) return;

    // Show/hide threshold (pixels from top)
    const SCROLL_THRESHOLD = 400;

    function updateVisibility() {
      const scrollY = window.scrollY || document.documentElement.scrollTop;

      if (scrollY > SCROLL_THRESHOLD) {
        button.classList.remove('opacity-0', 'translate-y-20');
        button.classList.add('opacity-100', 'translate-y-0');
      } else {
        button.classList.add('opacity-0', 'translate-y-20');
        button.classList.remove('opacity-100', 'translate-y-0');
      }
    }

    // Scroll to top on click
    button.addEventListener('click', () => {
      window.scrollTo({
        top: 0,
        behavior: 'smooth',
      });
    });

    // Update on scroll
    let ticking = false;
    window.addEventListener(
      'scroll',
      () => {
        if (!ticking) {
          requestAnimationFrame(() => {
            updateVisibility();
            ticking = false;
          });
          ticking = true;
        }
      },
      { passive: true }
    );

    // Initial check
    updateVisibility();
  }

  // Initialize on load
  initBackToTop();

  // Re-initialize after view transitions
  document.addEventListener('astro:after-swap', initBackToTop);
</script>
