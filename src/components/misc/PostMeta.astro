---
/**
 * Post Meta Component
 *
 * @description Displays metadata for a blog post.
 * Shows date, reading time, category, tags, and other info.
 */

import { Icon } from 'astro-icon/components';
import type { CollectionEntry } from 'astro:content';
import { formatDate, getRelativeTime } from '@utils/date-utils';
import { getCategoryUrl, getTagUrl } from '@utils/url-utils';
import { i18n, I18nKey } from '@i18n/index';

interface Props {
  /** The post entry from content collection */
  post: CollectionEntry<'posts'>;
  /** Whether to show a compact version */
  compact?: boolean;
}

const { post, compact = false } = Astro.props;

const { published, updated, category, tags } = post.data;

// Calculate reading time (rough estimate: 200 words per minute)
const wordCount = post.body?.split(/\s+/).length || 0;
const readingTime = Math.max(1, Math.ceil(wordCount / 200));
---

<div class:list={['flex flex-wrap items-center gap-x-4 gap-y-2', compact ? 'text-sm' : 'text-sm']}>
  <!-- Published Date -->
  <div class="flex items-center gap-1 text-[var(--text-tertiary)]" title={formatDate(published)}>
    <Icon name="material-symbols:calendar-today-outline" class="h-4 w-4" />
    <time datetime={published.toISOString()}>
      {compact ? getRelativeTime(published) : formatDate(published)}
    </time>
  </div>

  <!-- Updated Date (if different from published) -->
  {
    updated && updated.getTime() !== published.getTime() && !compact && (
      <div
        class="flex items-center gap-1 text-[var(--text-tertiary)]"
        title={`Updated: ${formatDate(updated)}`}
      >
        <Icon name="material-symbols:update" class="h-4 w-4" />
        <time datetime={updated.toISOString()}>
          Updated {getRelativeTime(updated)}
        </time>
      </div>
    )
  }

  <!-- Reading Time -->
  <div class="flex items-center gap-1 text-[var(--text-tertiary)]">
    <Icon name="material-symbols:schedule-outline" class="h-4 w-4" />
    <span>{readingTime} {i18n(I18nKey.minuteRead)}</span>
  </div>

  <!-- Word Count (non-compact only) -->
  {
    !compact && (
      <div class="flex items-center gap-1 text-[var(--text-tertiary)]">
        <Icon name="material-symbols:notes" class="h-4 w-4" />
        <span>{wordCount.toLocaleString()} words</span>
      </div>
    )
  }

  <!-- Category -->
  {
    category && (
      <a
        href={getCategoryUrl(category)}
        class="flex items-center gap-1 text-[oklch(var(--primary))] transition-colors hover:underline"
      >
        <Icon name="material-symbols:folder-outline" class="h-4 w-4" />
        <span>{category}</span>
      </a>
    )
  }
</div>

<!-- Tags (non-compact only) -->
{
  tags && tags.length > 0 && !compact && (
    <div class="mt-3 flex flex-wrap items-center gap-2">
      <Icon name="material-symbols:tag" class="h-4 w-4 text-[var(--text-tertiary)]" />
      {tags.map((tag) => (
        <a
          href={getTagUrl(tag)}
          class="rounded-md bg-[var(--btn-regular-bg)] px-2 py-0.5 text-xs text-[var(--text-secondary)] transition-colors hover:bg-[var(--btn-hover-bg)] hover:text-[var(--text-primary)]"
        >
          #{tag}
        </a>
      ))}
    </div>
  )
}
