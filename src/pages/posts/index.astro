---
/**
 * All Posts Page
 *
 * @description Lists all blog posts with category filtering.
 * Uses the three-column dashboard layout.
 *
 * @route /posts/
 */

import DashboardLayout from '@layouts/DashboardLayout.astro';
import PostCard from '@components/card/PostCard.astro';
import { getSortedPosts } from '@utils/content-utils';
import { i18n, I18nKey } from '@i18n/index';

// Get all posts sorted by date
const allPosts = await getSortedPosts();

// Group posts by year
const postsByYear = allPosts.reduce(
  (acc, post) => {
    const year = new Date(post.data.published).getFullYear();
    if (!acc[year]) acc[year] = [];
    acc[year].push(post);
    return acc;
  },
  {} as Record<number, typeof allPosts>
);

// Sort years descending
const sortedYears = Object.keys(postsByYear)
  .map(Number)
  .sort((a, b) => b - a);
---

<DashboardLayout
  title={i18n(I18nKey.allPosts)}
  description="Browse all blog posts organized by date and category"
>
  <div class="posts-page">
    {/* Page Header */}
    <header class="page-header">
      <h1 class="page-title">{i18n(I18nKey.allPosts)}</h1>
      <p class="page-subtitle">
        {allPosts.length}
        {allPosts.length === 1 ? i18n(I18nKey.postCount) : i18n(I18nKey.postsCount)}
      </p>
    </header>

    {/* Posts grouped by year */}
    <div class="posts-timeline">
      {sortedYears.map((year) => (
        <section class="year-section">
          <h2 class="year-header">
            <span class="year-text">{year}</span>
            <span class="year-count">
              {postsByYear[year].length} {postsByYear[year].length === 1 ? 'post' : 'posts'}
            </span>
          </h2>

          <div class="posts-list">
            {postsByYear[year].map((post) => (
              <PostCard post={post} />
            ))}
          </div>
        </section>
      ))}
    </div>

    {/* Empty State */}
    {allPosts.length === 0 && (
      <div class="empty-state">
        <p>{i18n(I18nKey.archiveEmpty)}</p>
      </div>
    )}
  </div>
</DashboardLayout>

<style>
  .posts-page {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  /* Page Header - minimal */
  .page-header {
    margin-bottom: 0.5rem;
  }

  .page-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.25rem;
  }

  .page-subtitle {
    font-size: 0.875rem;
    color: var(--text-tertiary);
  }

  /* Timeline */
  .posts-timeline {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .year-section {
    position: relative;
  }

  .year-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem 0;
    margin-bottom: 0.75rem;
  }

  .year-text {
    font-size: 1.125rem;
    font-weight: 700;
    color: oklch(var(--primary));
  }

  .year-count {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    font-weight: 500;
    padding: 0.125rem 0.5rem;
    background: var(--btn-regular-bg);
    border-radius: 9999px;
  }

  /* Posts list - Fuwari style */
  .posts-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    background: var(--card-bg);
    border-radius: var(--radius-large);
    padding: 0.25rem 0;
  }

  @media (min-width: 768px) {
    .posts-list {
      background: transparent;
      padding: 0;
    }
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background: var(--card-bg);
    border-radius: var(--radius-large);
    color: var(--text-secondary);
  }
</style>
