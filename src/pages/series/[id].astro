---
/**
 * Series Detail Page
 *
 * @description Shows all posts in a specific series with numbered order.
 * Uses DashboardLayout for consistent three-column navigation.
 *
 * @route /series/[id]/
 */

import DashboardLayout from '@layouts/DashboardLayout.astro';
import PostCard from '@components/card/PostCard.astro';
import { getSortedSeries } from '@/data/series';
import { getSortedPosts } from '@utils/content-utils';
import { getUrl } from '@utils/url-utils';
import { Icon } from 'astro-icon/components';
import { i18n, I18nKey } from '@i18n/index';

// Generate static paths for all series
export async function getStaticPaths() {
  const allSeries = getSortedSeries();
  const allPosts = await getSortedPosts();

  return allSeries.map((series) => {
    const seriesPosts = allPosts.filter(post => post.data.series === series.id);
    return {
      params: { id: series.id },
      props: { series, posts: seriesPosts },
    };
  });
}

const { series, posts } = Astro.props;
---

<DashboardLayout title={`${series.name} Series`} description={series.description} activeSeries={series.id}>
  <div class="space-y-6">
    <!-- Series Header -->
    <header class="card-base p-6">
      <a
        href={getUrl('/series/')}
        class="mb-4 inline-flex items-center gap-1.5 text-sm text-[var(--text-secondary)] hover:text-[oklch(var(--primary))] transition-colors"
      >
        <Icon name="material-symbols:arrow-back" class="h-4 w-4" />
        {i18n(I18nKey.backToSeries)}
      </a>

      <div class="flex items-start gap-4">
        <div class="flex h-14 w-14 shrink-0 items-center justify-center rounded-xl bg-[oklch(var(--primary)/0.1)]">
          <Icon name={series.icon || 'material-symbols:folder'} class="h-7 w-7 text-[oklch(var(--primary))]" />
        </div>
        <div>
          <h1 class="text-2xl font-bold text-[var(--text-primary)] md:text-3xl">
            {series.name}
          </h1>
          {series.description && (
            <p class="mt-2 text-[var(--text-secondary)]">
              {series.description}
            </p>
          )}
          <p class="mt-2 text-sm text-[var(--text-tertiary)]">
            {posts.length} {posts.length === 1 ? 'post' : 'posts'}
          </p>
        </div>
      </div>
    </header>

    <!-- Posts List -->
    {posts.length > 0 ? (
      <div class="space-y-4">
        {posts.map((post, index) => (
          <div class="relative pl-10">
            <!-- Step Number -->
            <div class="absolute left-0 top-1/2 -translate-y-1/2 flex h-7 w-7 items-center justify-center rounded-full bg-[oklch(var(--primary)/0.1)] text-sm font-semibold text-[oklch(var(--primary))]">
              {index + 1}
            </div>
            <PostCard post={post} />
          </div>
        ))}
      </div>
    ) : (
      <div class="card-base p-8 text-center">
        <Icon name="material-symbols:folder-open-outline" class="mx-auto h-12 w-12 text-[var(--text-tertiary)]" />
        <p class="mt-3 text-[var(--text-secondary)]">{i18n(I18nKey.noPostsInSeries)}</p>
      </div>
    )}
  </div>
</DashboardLayout>
