---
/**
 * Home Page
 *
 * @description The main landing page showing recent blog posts.
 * Uses three-column dashboard layout with category navigation.
 *
 * @route /
 */

import DashboardLayout from '@layouts/DashboardLayout.astro';
import PostCard from '@components/card/PostCard.astro';
import Pagination from '@components/misc/Pagination.astro';
import { getSortedPosts } from '@utils/content-utils';
import { getUrl } from '@utils/url-utils';
import { PAGE_SIZE } from '@constants/constants';
import { siteConfig, profileConfig } from '@/config';
import { i18n, I18nKey } from '@i18n/index';
import { Icon } from 'astro-icon/components';

// Get all posts sorted by date
const allPosts = await getSortedPosts();

// First page posts
const posts = allPosts.slice(0, PAGE_SIZE);

// Calculate pagination
const totalPages = Math.ceil(allPosts.length / PAGE_SIZE);
---

<DashboardLayout title={siteConfig.title} description={siteConfig.subtitle}>
  <div class="home-page">
    {/* Hero/Intro Section */}
    <section class="intro-card card-base">
      <div class="intro-content">
        <img
          src={profileConfig.avatar}
          alt={profileConfig.name}
          class="intro-avatar"
        />
        <div class="intro-text">
          <h1 class="intro-greeting">
            Hi, I'm <span class="intro-name">{profileConfig.name}</span> ðŸ‘‹
          </h1>
          <p class="intro-bio">{profileConfig.bio}</p>
          {profileConfig.links && profileConfig.links.length > 0 && (
            <div class="intro-links">
              {profileConfig.links.map((link) => (
                <a
                  href={link.url}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="intro-link"
                  title={link.name}
                >
                  <Icon name={link.icon} class="w-5 h-5" />
                </a>
              ))}
            </div>
          )}
        </div>
      </div>
    </section>

    {/* Recent Posts Section */}
    <section class="posts-section">
      <div class="section-header">
        <h2 class="section-title">{i18n(I18nKey.recentPosts)}</h2>
        <a href={getUrl('/posts/')} class="view-all-link">
          {i18n(I18nKey.viewAll)} â†’
        </a>
      </div>

      {/* Posts List */}
      {posts.length > 0 ? (
        <div class="posts-list">
          {posts.map((post) => (
            <PostCard post={post} />
          ))}
        </div>
      ) : (
        <div class="empty-state">
          <p>{i18n(I18nKey.archiveEmpty)}</p>
        </div>
      )}
    </section>

    {/* Pagination */}
    {totalPages > 1 && (
      <Pagination
        currentPage={1}
        totalPages={totalPages}
        baseUrl={getUrl('/page/')}
      />
    )}
  </div>
</DashboardLayout>

<style>
  .home-page {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  /* Intro Card */
  .intro-card {
    padding: 1.5rem;
  }

  .intro-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: 1rem;
  }

  @media (min-width: 640px) {
    .intro-content {
      flex-direction: row;
      text-align: left;
      gap: 1.5rem;
    }
  }

  .intro-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid oklch(var(--primary) / 0.3);
    flex-shrink: 0;
  }

  .intro-text {
    flex: 1;
  }

  .intro-greeting {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
  }

  .intro-name {
    color: oklch(var(--primary));
  }

  .intro-bio {
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: 0.75rem;
  }

  .intro-links {
    display: flex;
    gap: 0.75rem;
    justify-content: center;
  }

  @media (min-width: 640px) {
    .intro-links {
      justify-content: flex-start;
    }
  }

  .intro-link {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--btn-regular-bg);
    color: var(--text-secondary);
    transition: all 0.2s ease;
  }

  .intro-link:hover {
    background: oklch(var(--primary));
    color: white;
    transform: translateY(-2px);
  }

  /* Posts Section */
  .posts-section {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 0.5rem;
  }

  .section-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text-primary);
  }

  .view-all-link {
    font-size: 0.875rem;
    color: oklch(var(--primary));
    text-decoration: none;
    font-weight: 500;
    transition: opacity 0.15s ease;
  }

  .view-all-link:hover {
    opacity: 0.8;
  }

  /* Posts List */
  .posts-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    background: var(--card-bg);
    border-radius: var(--radius-large);
    padding: 0.25rem 0;
  }

  @media (min-width: 768px) {
    .posts-list {
      background: transparent;
      padding: 0;
    }
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background: var(--card-bg);
    border-radius: var(--radius-large);
    color: var(--text-secondary);
  }
</style>
